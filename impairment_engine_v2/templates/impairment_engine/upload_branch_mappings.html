{% extends 'impairment_engine/base.html' %}
{% load static %}

{% block content %}
<div class="container d-flex justify-content-center py-4">
  <div class="col-lg-8">
    <div class="card my-4">
      <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
        <div class="bg-gradient-secondary shadow-primary border-radius-lg pt-4 pb-3">
          <h6 class="text-white text-capitalize text-center ps-3">
            <i class="fas fa-upload me-2"></i> Company Branch Mappings
          </h6>
        </div>
      </div>

      <div class="card-body">
          <form method="post" enctype="multipart/form-data" action="{% url 'upload_branch_mappings' company_slug=company_slug %}" id="uploadForm">
            {% csrf_token %}

            <div class="d-flex justify-content-end mb-3">
              <a href="{% url 'download_branch_mappings' %}" class="btn btn-outline-secondary">
                <i class="fas fa-file-download me-2"></i> Download Template
              </a>
            </div>

            <div class="file-upload-wrapper mb-4">
              <div class="file-upload-container border rounded p-5 text-center">
                <h5 class="mb-2">Upload Branch Mappings data file</h5>
                <p class="text-muted mb-3">Supports .xlsx and .xls formats</p>

                <label class="btn btn-outline-primary px-4">
                  <i class="fas fa-folder-open me-2"></i>Browse Files
                  <input type="file" class="d-none" name="excel_file" accept=".xlsx,.xls" required>
                </label>
                <div class="mt-3">
                  <small class="text-muted">Selected file: <span id="file-name">None</span></small>
                </div>
              </div>
            </div>

            <div class="text-end">
              <button type="submit" class="btn btn-primary px-4" id="uploadBtn">
                <span class="btn-text">Upload Data</span>
                <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
              </button>
            </div>
          </form>

      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Show selected file name
  document.querySelector('input[type="file"]')?.addEventListener('change', function(e) {
    const fileName = e.target.files[0] ? e.target.files[0].name : 'None';
    document.getElementById('file-name').textContent = fileName;
  });

  document.getElementById('uploadForm')?.addEventListener('submit', function() {
    const btn = document.getElementById('uploadBtn');
    btn.disabled = true;
    btn.querySelector('.btn-text').classList.add('d-none');
    btn.querySelector('.spinner-border').classList.remove('d-none');
  });
</script>

<style>
  .file-upload-container {
    background-color: #f8f9fa;
    cursor: pointer;
    transition: all 0.2s;
  }

  .file-upload-container:hover {
    background-color: #f1f3f5;
  }

  /* Smooth transition for button states */
  button .spinner-border {
    transition: opacity 0.3s ease;
  }

  button .btn-text {
    transition: opacity 0.3s ease;
  }
</style>
{% endblock %}